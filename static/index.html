<!DOCTYPE html>
<html>
<head>  
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/ace.js"></script>
</head>

<body>

<h3>Select Concept and Question</h3>

<form>

<label for="concepts">Concept:</label>

<select id="concepts">
  <option>Select concept</option>  
</select>

<br><br>

<label for="questions">Question:</label>

<select id="questions">
  <option>Select question</option>
</select>

<br><br>

<label for="code-editor">Code:</label>
<div id="code-editor" style="height: 200px;"></div>

<br><br>

<input type="submit" value="Submit">

</form>

<script>

// Initialize code editor
var editor = ace.edit("code-editor");
editor.setTheme("ace/theme/monokai");
editor.session.setMode("ace/mode/javascript");


// Fetch problems JSON 
$.getJSON("/static/problems.json", function(data) {

  // Get concepts
  var concepts = data.map(d => d.concept);
  
  // Remove duplicates
  concepts = [...new Set(concepts)];
  
  // Add default option
  concepts.unshift("Select concept");

  // Populate concepts dropdown
  concepts.forEach(conceptNum => {

    // Find concept object
    var concept = data.find(c => c.concept == conceptNum);

    $("#concepts").append(
      $('<option>', {
        value: concept.concept,
        text: concept.concept + ": " + concept.title
      })
    );
  });

  // On concept change 
  $("#concepts").change(function() {
    
    // Get selected concept 
    var selectedConcept = $(this).val();
    
    // Get questions for concept
    var questions = data.find(d => d.concept == selectedConcept).questions;

    // Remove old options
    $('#questions').find('option').remove();

    // Add default option
    $("#questions").append('<option>Select question</option>');

    // Populate questions dropdown 
    questions.forEach(question => {
      $("#questions").append(
        $('<option>', {
          value: question.number,
          text: "Q" + question.number + ": " + question.text
        })
      )
    });

  });


  // On form submit
  $("form").submit(function(e) {
    e.preventDefault();

    // Get selected concept, question, and code
    var selectedConcept = $("#concepts").val();
    var selectedQuestion = $("#questions").val();
    var code = editor.getValue();

    // Do something with the selected concept, question, and code
    // console.log("Selected Concept: " + selectedConcept);
    // console.log("Selected Question: " + selectedQuestion);
    // console.log("Enter your code here: " + code);

    fetch("http://localhost:8000/check_code/", {
        method: "POST",
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({
            question: selectedQuestion,
            code: code
        })
    })
    .then(response => response.json())
    .then(data => console.log(data))
    .catch((error) => {
        console.error('Error:', error);
    });

  });

}); // This is the missing closing brace

</script>

</body>
</html>
